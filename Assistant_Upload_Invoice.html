<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Expense Module — HR Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--blue:#0b5cff;--navy:#08306b;--muted:#6b7280;--bg:#f5f7fb;--card:#ffffff;--success:#12b76a;--warn:#f59e0b;--danger:#ef4444;--glass: rgba(11,92,255,0.06);}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#0f172a}
  header{background:#fff;padding:16px 28px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;justify-content:space-between}
  .brand{font-weight:700;color:var(--navy);font-size:18px}
  nav{display:flex;gap:12px;align-items:center}
  nav a{color:var(--navy);text-decoration:none;font-weight:600}
  .wrap{max-width:1200px;margin:28px auto;padding:0 20px}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(12,20,40,0.06);border:1px solid rgba(12,20,40,0.04)}
  .row{display:flex;gap:12px;align-items:center}
  h1{margin:0;color:var(--navy);font-size:22px}
  .lead{color:var(--muted);margin-top:6px}
  .summary{display:flex;gap:12px;margin-top:14px}
  .sum-card{flex:1;padding:14px;border-radius:10px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid rgba(11,92,255,0.06)}
  .sum-title{font-size:13px;color:var(--muted);font-weight:600}
  .sum-value{font-size:20px;color:var(--navy);font-weight:700;margin-top:6px}
  .chart-wrap{margin-top:18px}
  .chart{width:100%;height:260px;background:linear-gradient(180deg,#ffffff,#fbfdff);border-radius:10px;padding:10px;border:1px solid rgba(11,92,255,0.04)}
  .upload-box{border:2px dashed var(--glass);border-radius:10px;padding:12px;text-align:center;color:var(--muted);cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  .timeline{margin-top:12px}
  .timeline .event{padding:8px;border-left:3px solid var(--glass);margin-bottom:10px;background:#fff;border-radius:8px;border:1px solid rgba(2,6,23,0.03)}
  .action-btn{background:#f3f4f6;border-radius:8px;padding:6px 10px;border:1px solid #e6eef6;cursor:pointer}
  .status-pill{padding:6px 8px;border-radius:999px;font-weight:700;font-size:13px;display:inline-block}
  .s-pending{background:#fff7ed;color:#9a5800}
  .s-under{background:#fff7ed;color:#9a5800}
  .s-approved{background:#ecfdf5;color:var(--success)}
  .s-rejected{background:#fff1f2;color:var(--danger)}
  .icon-btn{background:transparent;border:0;cursor:pointer;padding:8px;border-radius:8px;display:inline-flex;align-items:center}

  .upload-neutral{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:8px;
    border:1px solid #e6eef6;
    background:#fff;
    color:var(--navy);
    font-weight:700;
    cursor:pointer;
    text-decoration:none;
  }
  .upload-neutral:hover{background:rgba(11,92,255,0.03);}

  #invoiceBtn { all: unset; display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:8px; border:1px solid #e6eef6; background:#fff; color:var(--navy); font-weight:700; cursor:pointer; text-decoration:none; }
  #invoiceBtn:hover{ background:rgba(11,92,255,0.03); }

  .dropdown{position:absolute;right:0;top:44px;background:#fff;border-radius:8px;box-shadow:0 10px 30px rgba(2,6,23,.12);border:1px solid rgba(2,6,23,.04);overflow:hidden;width:420px;max-width:calc(100vw - 40px);z-index:60}
  .dropdown .head{padding:12px 14px;font-weight:700;border-bottom:1px solid #f1f5f9}
  .dropdown .body{max-height:420px;overflow:auto;padding:12px 14px}
  table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
  th,td{padding:8px 6px;text-align:left;border-bottom:1px solid #f1f5f9;color:#0f172a}
  th{font-weight:700;color:var(--muted);font-size:12px}
  a.inv { color:var(--navy); font-weight:700; text-decoration:none; cursor:pointer; }
  a.inv:hover { text-decoration:underline; }
  .small-muted{font-size:12px;color:var(--muted)}
  .progress-bar{transition:width .3s linear}
  .clickable-num { color:var(--blue); font-weight:800; text-decoration:underline; cursor:pointer; }
  @media(max-width:1000px){ .grid{grid-template-columns:1fr} .right-panel{order:2} .left-panel{order:1} .dropdown{width:320px} }
</style>
</head>
<body>
<header>
  <div class="brand">Expense Module</div>
  <nav>
    <div style="position:relative">
      <button id="uploadBtn" class="upload-neutral" aria-haspopup="true" aria-expanded="false" title="Upload">Upload</button>
      <div id="uploadMenu" class="dropdown" role="menu" aria-hidden="true" style="display:none">
        <div class="head">Upload</div>
        <div class="body">
          <button data-action="uploadInvoice" style="width:100%;text-align:left;padding:10px;border:0;background:transparent;cursor:pointer">Upload New Invoice / Receipt</button>
          <button data-action="scanUpload" style="width:100%;text-align:left;padding:10px;border:0;background:transparent;cursor:pointer">Scan & Upload</button>
          <button data-action="bulkUpload" style="width:100%;text-align:left;padding:10px;border:0;background:transparent;cursor:pointer">Bulk Upload</button>
        </div>
      </div>
    </div>

    <div style="position:relative">
      <a id="invoiceBtn" href="invoice_management.html" title="Invoice Management" role="button">Invoice Management</a>
    </div>

    <div style="position:relative">
      <button id="notifBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" title="Notifications">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M15 17H9a2 2 0 0 1-2-2V11a6 6 0 0 1 12 0v4a2 2 0 0 1-2 2Z" stroke="#0b5cff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="#0b5cff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span id="notifBadge" style="display:inline-block;background:#ef4444;color:#fff;border-radius:999px;padding:4px 7px;font-size:12px;margin-left:6px;min-width:28px;text-align:center;box-shadow:0 4px 10px rgba(239,68,68,.18);transform-origin:center">3</span>
      </button>
      <div id="notifMenu" class="dropdown" role="menu" aria-hidden="true" style="display:none;width:360px">
        <div class="head">Notifications <div style="float:right;font-weight:600"><button id="markAllBtn" style="background:transparent;border:0;color:#0b5cff;cursor:pointer;font-weight:700">Mark all read</button></div></div>
        <div class="body" id="notifList">
          <div class="notif-item" data-read="false" style="padding:8px;border-bottom:1px solid #f8fafc"><div style="font-weight:700"><a class="inv" data-inv="INV-2025-002">INV-2025-002</a></div><div style="font-size:13px;color:#6b7280">Submitted by HR Assistant • 2 hours ago</div></div>
          <div class="notif-item" data-read="false" style="padding:8px;border-bottom:1px solid #f8fafc"><div style="font-weight:700"><a class="inv" data-inv="INV-2025-001">INV-2025-001</a></div><div style="font-size:13px;color:#6b7280">Pending director review • Yesterday</div></div>
          <div class="notif-item" data-read="false" style="padding:8px"><div style="font-weight:700"><a class="inv" data-inv="INV-2025-003">INV-2025-003</a></div><div style="font-size:13px;color:#6b7280">Monthly report ready</div></div>
        </div>
      </div>
    </div>

    <div style="position:relative">
      <button id="userBtn" aria-haspopup="true" aria-expanded="false" class="icon-btn" title="Account">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><circle cx="12" cy="12" r="11" fill="#eef6ff" stroke="#0b5cff" stroke-width="1.2"></circle><path d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="#0b5cff"/><path d="M4 20c1.5-3 6-4 8-4s6.5 1 8 4" stroke="#0b5cff" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div id="userMenu" class="dropdown" role="menu" aria-hidden="true" style="display:none;width:220px">
        <div class="head" style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:700">HR Assistant</div><div class="small-muted">hr.assistant@company.com</div></div><a id="acctPrefs" href="#account-preferences" title="Account preferences" style="color:#0b5cff">Prefs</a></div>
        <div class="body"><button data-menu="profile" style="width:100%;text-align:left;padding:10px;border:0;background:transparent;cursor:pointer">Profile</button><button data-menu="settings" style="width:100%;text-align:left;padding:10px;border:0;background:transparent;cursor:pointer">Settings</button><button id="signOutBtn" style="width:100%;padding:10px;border-radius:8px;border:0;background:#ef4444;color:#fff;cursor:pointer;margin-top:6px">Sign out</button></div>
      </div>
    </div>
  </nav>
</header>

<main class="wrap">
  <div class="grid">
    <section class="left-panel">
      <div class="card">
        <div class="row" style="justify-content:space-between"><div><h1>Hello, HR Assistant</h1><div class="lead">Expense Dashboard</div></div></div>
        <div class="summary" aria-hidden="false">
          <div class="sum-card">
            <div class="sum-title">Pending Reviews</div>
            <div class="sum-value" id="pendingCountWrap"><a id="pendingNumLink" class="clickable-num" href="#">8</a></div>
            <div class="small" style="margin-top:8px">Invoices awaiting Director approval</div>
          </div>
          <div class="sum-card"><div class="sum-title">Total Invoices</div><div class="sum-value" id="totalCount">24</div><div class="small" style="margin-top:8px">Records in the system</div></div>
          <div class="sum-card"><div class="sum-title">Total Value</div><div class="sum-value" id="totalValue">$28,430</div><div class="small" style="margin-top:8px">Sum of invoice amounts</div></div>
        </div>

        <div class="chart-wrap">
          <div class="chart" role="img" aria-label="Expenses vs Revenue chart showing months January to October and Y-axis values 30k to 120k">
            <svg viewBox="0 0 820 260" preserveAspectRatio="xMidYMid meet" style="width:100%;height:100%">
              <defs><linearGradient id="g1" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="#e6f0ff"/><stop offset="1" stop-color="#ffffff"/></linearGradient></defs>
              <rect x="0" y="0" width="100%" height="100%" fill="url(#g1)"></rect>
              <g fill="#94a3b8" font-size="12" text-anchor="end" font-family="Inter, system-ui, Arial">
                <text x="48" y="40">120k</text>
                <text x="48" y="90">90k</text>
                <text x="48" y="140">60k</text>
                <text x="48" y="190">30k</text>
              </g>
              <g stroke="#eef4ff" stroke-width="1">
                <line x1="60" x2="780" y1="30" y2="30"></line>
                <line x1="60" x2="780" y1="80" y2="80"></line>
                <line x1="60" x2="780" y1="130" y2="130"></line>
                <line x1="60" x2="780" y1="180" y2="180"></line>
              </g>
              <g stroke="#dbeafe" stroke-width="1"><line x1="60" x2="60" y1="20" y2="200"></line></g>
              <polyline fill="none" stroke="#0b5cff" stroke-width="3" points="60,150 140,130 220,90 300,60 380,80 460,70 540,90 620,100 700,80 780,60"></polyline>
              <polyline fill="none" stroke="#9aaedb" stroke-width="2" points="60,160 140,155 220,150 300,145 380,148 460,142 540,145 620,150 700,148 780,145"></polyline>
              <g fill="#94a3b8" font-size="12" text-anchor="middle" font-family="Inter, system-ui, Arial">
                <text x="60"  y="225">Jan</text>
                <text x="140" y="225">Feb</text>
                <text x="220" y="225">Mar</text>
                <text x="300" y="225">Apr</text>
                <text x="380" y="225">May</text>
                <text x="460" y="225">Jun</text>
                <text x="540" y="225">Jul</text>
                <text x="620" y="225">Aug</text>
                <text x="700" y="225">Sep</text>
                <text x="780" y="225">Oct</text>
              </g>
              <g font-family="Inter, system-ui, Arial" font-size="13" fill="#0f172a">
                <text x="780" y="20" text-anchor="end" font-weight="700">Total: $28,430</text>
              </g>
            </svg>
          </div>

          <div style="display:flex;gap:12px;margin-top:12px;align-items:center">
            <div class="card" style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Category Breakdown</strong><div class="small">Top 4 categories</div></div><div class="small">Last 30 days</div></div>
              <div style="display:flex;gap:12px;margin-top:12px;align-items:center">
                <div style="width:120px;height:120px"><svg viewBox="0 0 32 32" style="width:100%;height:100%"><circle r="10" cx="16" cy="16" fill="transparent" stroke="#eef2ff" stroke-width="10"></circle><circle r="10" cx="16" cy="16" fill="transparent" stroke="#0b5cff" stroke-width="10" stroke-dasharray="40 60" stroke-dashoffset="25"></circle><circle r="10" cx="16" cy="16" fill="transparent" stroke="#9aaedb" stroke-width="10" stroke-dasharray="25 75" stroke-dashoffset="-15"></circle></svg></div>
                <div style="flex:1"><div class="small"><strong>Office Supplies</strong> <div class="small-muted">$7,200</div></div><div style="height:8px"></div><div class="small"><strong>Travel</strong> <div class="small-muted">$5,120</div></div><div style="height:8px"></div><div class="small"><strong>Rent</strong> <div class="small-muted">$9,000</div></div><div style="height:8px"></div><div class="small"><strong>Entertainment</strong> <div class="small-muted">$7,110</div></div></div>
              </div>
            </div>

            <div style="width:320px" class="card">
              <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Pending Reviews</strong><div class="small">Needs Assistant action</div></div><div style="text-align:right"><div class="num" style="font-weight:700;color:var(--navy);font-size:20px" id="pendingNumDisplay">8</div></div></div>
              <div class="timeline" id="pendingList" style="margin-top:12px">
                <div class="event"><strong><a class="inv" data-inv="INV-2025-001">INV-2025-001</a></strong><div class="small">ABC Supplies • $1,250 • 2 attachments</div></div>
                <div class="event"><strong><a class="inv" data-inv="INV-2025-002">INV-2025-002</a></strong><div class="small">Travel Co • $420 • 1 attachment</div></div>
                <div class="event"><strong><a class="inv" data-inv="INV-2025-003">INV-2025-003</a></strong><div class="small">OfficeMax • $210 • 0 attachments</div></div>
                <div class="event"><strong><a class="inv" data-inv="INV-2025-004">INV-2025-004</a></strong><div class="small">Catering Ltd • $980 • 1 attachment</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <aside class="right-panel">
      <div class="card" id="quickUploadCard" style="margin-bottom:12px">
        <strong>Upload New Invoice/Receipt</strong>
        <div class="small" style="margin-top:6px">Drag & drop files or click to select</div>
        <label class="upload-box" id="quickUpload" style="margin-top:10px;cursor:pointer">
          Drop files here or click to upload
          <input id="quickUploadInput" type="file" accept=".pdf,image/*" multiple style="display:none" />
        </label>
      </div>

      <div class="card" id="uploadStatusCard" style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong>Upload Status & Progress</strong>
            <div class="small" style="margin-top:4px">Recent uploads and OCR progress</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="clearUploadList" class="upload-neutral" style="font-weight:600;padding:6px 10px">Clear</button>
          </div>
        </div>

        <div id="uploadList" style="margin-top:12px;display:flex;flex-direction:column;gap:12px">
          <!-- example completed items -->
          <div class="upload-item" data-id="inv-001" style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="display:flex;gap:10px;align-items:center">
                <div style="width:36px;height:36;border-radius:8px;background:#eef6ff;display:flex;align-items:center;justify-content:center;color:var(--navy);font-weight:700">PDF</div>
                <div>
                  <div style="font-weight:700;color:var(--navy)">invoice_oct_001.pdf</div>
                  <div class="small-muted" style="margin-top:4px">1.2 MB</div>
                </div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="small-muted" id="status-inv-001">Complete</div>
                <button class="action-btn open-file" data-id="inv-001">Open</button>
              </div>
            </div>
            <div style="display:flex;gap:12px;align-items:center">
              <div style="flex:1;background:#f1f5f9;border-radius:8px;height:10px;overflow:hidden">
                <div class="progress-bar" id="progress-inv-001" style="height:100%;width:100%;background:linear-gradient(90deg,var(--blue),#6ea8ff)"></div>
              </div>
              <div style="width:56px;text-align:right;font-weight:700">100%</div>
            </div>
          </div>

          <div class="upload-item" data-id="inv-002" style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="display:flex;gap:10px;align-items:center">
                <div style="width:36px;height:36;border-radius:8px;background:#fff7ed;display:flex;align-items:center;justify-content:center;color:#9a5800;font-weight:700">IMG</div>
                <div>
                  <div style="font-weight:700;color:var(--navy)">receipt_sep_22.jpg</div>
                  <div class="small-muted" style="margin-top:4px">0.4 MB</div>
                </div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="small-muted" id="status-inv-002">Complete</div>
                <button class="action-btn open-file" data-id="inv-002">Open</button>
              </div>
            </div>
            <div style="display:flex;gap:12px;align-items:center">
              <div style="flex:1;background:#f1f5f9;border-radius:8px;height:10px;overflow:hidden">
                <div class="progress-bar" id="progress-inv-002" style="height:100%;width:100%;background:linear-gradient(90deg,#f59e0b,#ffd08a)"></div>
              </div>
              <div style="width:56px;text-align:right;font-weight:700">100%</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <strong>Recent Activity</strong>
        <div class="small" style="margin-top:8px">Latest system events and actions</div>
        <div style="margin-top:10px">
          <div class="small" style="margin-bottom:8px"><strong><a class="inv" data-inv="INV-2025-002">INV-2025-002</a></strong> submitted by HR Assistant • 2 hours ago</div>
          <div class="small" style="margin-bottom:8px"><strong><a class="inv" data-inv="INV-2025-001">INV-2025-001</a></strong> edited by HR Assistant • 1 day ago</div>
          <div class="small" style="margin-bottom:8px"><strong><a class="inv" data-inv="INV-2025-003">INV-2025-003</a></strong> approved by Director • 3 days ago</div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- Upload panel (single/scan/bulk) included and wired to Upload menu -->
<style>
  .upload-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.35);display:none;align-items:center;justify-content:center;z-index:300}
  .upload-panel{width:920px;max-width:calc(100vw - 32px);background:#fff;border-radius:12px;box-shadow:0 24px 60px rgba(2,6,23,0.3);overflow:hidden;display:grid;grid-template-columns:1fr 420px}
  .upload-panel header{padding:14px 16px;border-bottom:1px solid #eef2f7;display:flex;justify-content:space-between;align-items:center}
  .upload-panel .left{padding:16px;display:flex;flex-direction:column;gap:12px}
  .upload-panel .right{padding:16px;border-left:1px solid #eef2f7;display:flex;flex-direction:column;gap:12px}
  .upload-panel .h{font-weight:800}
  .upload-panel .muted{font-size:13px;color:var(--muted)}
  .upload-panel .input-file{display:block;width:100%;padding:10px;border:1px dashed #e6eef6;border-radius:8px;background:#fbfdff;cursor:pointer;text-align:center}
  .upload-panel .small{font-size:13px;color:var(--muted)}
  .upload-panel .btn{padding:10px 12px;border-radius:8px;border:0;cursor:pointer}
  .upload-panel .btn-primary{background:var(--blue);color:#fff}
  .upload-panel .btn-outline{background:#fff;border:1px solid #e6eef6;color:var(--navy)}
  .upload-panel .row{display:flex;gap:8px;align-items:center}
  .upload-panel .scan-preview{height:260px;background:#f8fafc;border-radius:8px;border:1px dashed #e6eef6;display:flex;align-items:center;justify-content:center;color:var(--muted)}
  .upload-panel .file-list{display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto}
  .upload-panel .file-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef4ff;background:#fff}
  .upload-panel .close-x{background:transparent;border:0;cursor:pointer;font-size:18px}
  @media(max-width:960px){ .upload-panel{grid-template-columns:1fr} .upload-panel .right{border-left:0;border-top:1px solid #eef2f7} }
</style>

<div id="uploadBackdrop" class="upload-backdrop" aria-hidden="true">
  <div id="uploadPanel" class="upload-panel" role="dialog" aria-modal="true" aria-labelledby="uploadPanelTitle">
    <header>
      <div>
        <div id="uploadPanelTitle" class="h">Upload</div>
        <div id="uploadPanelSubtitle" class="muted">Upload a single invoice, scan a document, or upload multiple files</div>
      </div>
      <div>
        <button id="closeUploadPanel" class="close-x" title="Close">✕</button>
      </div>
    </header>

    <div class="left" id="uploadLeft">
      <!-- Single upload body -->
      <div id="singleUploadBody" style="display:none">
        <div class="h">Upload single invoice / receipt</div>
        <div class="muted">Choose one file (PDF, JPG, PNG) and upload it</div>

        <label class="input-file" id="singleFileLabel">Click to choose file
          <input id="singleFileInput" type="file" accept=".pdf,image/*" style="display:none" />
        </label>

        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <div id="singleProgressWrap" style="display:none">
            <div style="height:10px;background:#f1f5f9;border-radius:8px;overflow:hidden">
              <div id="singleProgressBar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--blue),#6ea8ff);transition:width .2s linear"></div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
              <div class="small-muted" id="singleProgressText">Uploading 0%</div>
              <div><button id="singleCancel" class="btn btn-outline">Cancel</button></div>
            </div>
          </div>

          <div id="singleDoneWrap" style="display:none;align-items:center;gap:8px;justify-content:space-between">
            <div style="display:flex;flex-direction:column">
              <div style="font-weight:800">Done</div>
              <div class="small-muted">Upload complete</div>
            </div>
            <div style="display:flex;gap:8px">
              <a id="singleViewLink" class="upload-neutral" href="#" role="button">View uploaded invoice</a>
              <button id="singleDoneClose" class="btn btn-outline">Close</button>
            </div>
          </div>
        </div>

        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button id="singleClear" class="btn btn-outline">Clear</button>
          <button id="singleStartUploadBtn" class="btn btn-primary" disabled>Upload</button>
        </div>
      </div>
      <!-- END single upload body -->

      <!-- Scan upload body -->
      <div id="scanUploadBody" style="display:none">
        <div class="h">Scan & Upload</div>
        <div class="muted">Use your device camera or an attached scanner to capture the invoice</div>
        <div class="scan-preview" id="scanPreview">No scan yet</div>
        <div class="row">
          <button id="startScanBtn" class="btn btn-outline">Start Scan</button>
          <button id="captureScanBtn" class="btn btn-primary" disabled>Capture</button>
          <button id="retakeScanBtn" class="btn" style="display:none">Retake</button>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button id="scanCancel" class="btn btn-outline">Cancel</button>
          <button id="scanUploadBtn" class="btn btn-primary" disabled>Upload Scan</button>
        </div>
      </div>

      <!-- Bulk upload body -->
      <div id="bulkUploadBody" style="display:none">
        <div class="h">Bulk Upload</div>
        <div class="muted">Select multiple files to upload at once (PDF, JPG, PNG).</div>
        <label class="input-file" id="bulkFileLabel">Click to choose files<input id="bulkFileInput" type="file" accept=".pdf,image/*" multiple style="display:none" /></label>
        <div class="file-list" id="bulkFileList" aria-live="polite"></div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button id="bulkCancel" class="btn btn-outline">Cancel</button>
          <button id="bulkUploadBtn" class="btn btn-primary" disabled>Upload All</button>
        </div>
      </div>
    </div>

    <aside class="right" id="uploadRight">
      <div>
        <div class="h" id="rightTitle">Help</div>
        <div class="muted" id="rightDesc">Choose an option on the left to start uploading</div>
      </div>

      <div>
        <div style="margin-top:12px">
          <div style="font-weight:700">Tips</div>
          <ul style="margin:8px 0 0 16px;padding:0;color:var(--muted)">
            <li>Use clear scans for better OCR.</li>
            <li>Accepted formats: PDF, JPG, PNG.</li>
            <li>For bulk uploads, zip large batches first.</li>
          </ul>
        </div>

        <div style="margin-top:14px">
          <div style="font-weight:700">Recent uploads</div>
          <div style="margin-top:8px" id="rightRecent">
            <div class="file-item"><div>invoice_oct_001.pdf</div><div class="small-muted">1.2 MB</div></div>
            <div class="file-item" style="margin-top:8px"><div>receipt_sep_22.jpg</div><div class="small-muted">0.4 MB</div></div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
  // Utility
  const $ = id => document.getElementById(id);

  // Open/close upload panel
  function openUploadPanel(mode){
    $('uploadBackdrop').style.display = 'flex';
    $('uploadBackdrop').setAttribute('aria-hidden','false');
    $('singleUploadBody').style.display = 'none';
    $('scanUploadBody').style.display = 'none';
    $('bulkUploadBody').style.display = 'none';
    if(mode === 'single'){
      $('uploadPanelTitle').textContent = 'Upload single invoice / receipt';
      $('uploadPanelSubtitle').textContent = 'Choose a file and upload it';
      $('singleUploadBody').style.display = 'block';
    } else if(mode === 'scan'){
      $('uploadPanelTitle').textContent = 'Scan & Upload';
      $('uploadPanelSubtitle').textContent = 'Use your camera to capture the document';
      $('scanUploadBody').style.display = 'block';
    } else {
      $('uploadPanelTitle').textContent = 'Bulk upload';
      $('uploadPanelSubtitle').textContent = 'Select multiple files to upload';
      $('bulkUploadBody').style.display = 'block';
    }
  }
  function closeUploadPanel(){ $('uploadBackdrop').style.display='none'; $('uploadBackdrop').setAttribute('aria-hidden','true'); }

  // Wire Upload menu to open the panel
  document.getElementById('uploadMenu').addEventListener('click', e => {
    const action = e.target.getAttribute('data-action');
    if(!action) return;
    if(action === 'uploadInvoice') openUploadPanel('single');
    if(action === 'scanUpload') openUploadPanel('scan');
    if(action === 'bulkUpload') openUploadPanel('bulk');
  });
  document.getElementById('closeUploadPanel').addEventListener('click', closeUploadPanel);
  document.getElementById('uploadBackdrop').addEventListener('click', e=>{ if(e.target.id==='uploadBackdrop') closeUploadPanel(); });

  // Quick upload right-panel wiring (simulated upload)
  const quickUploadLabel = document.getElementById('quickUpload');
  const quickUploadInput = document.getElementById('quickUploadInput');
  quickUploadLabel && quickUploadLabel.addEventListener('click', ()=> quickUploadInput.click());
  quickUploadInput && quickUploadInput.addEventListener('change', e=>{
    const files = Array.from(e.target.files || []);
    if(!files.length) return;
    const list = document.getElementById('uploadList');
    files.forEach(f=>{
      const id = 'inv-' + Date.now() + '-' + Math.round(Math.random()*9999);
      const item = document.createElement('div');
      item.className = 'upload-item';
      item.dataset.id = id;
      item.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="display:flex;gap:10px;align-items:center">
            <div style="width:36px;height:36;border-radius:8px;background:#eef6ff;display:flex;align-items:center;justify-content:center;color:var(--navy);font-weight:700">${f.type.includes('pdf') ? 'PDF' : 'IMG'}</div>
            <div><div style="font-weight:700;color:var(--navy)">${f.name}</div><div class="small-muted" style="margin-top:4px">${Math.round(f.size/1024)} KB</div></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center"><div class="small-muted" id="status-${id}">Uploading</div><button class="action-btn open-file" data-id="${id}">Open</button></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="flex:1;background:#f1f5f9;border-radius:8px;height:10px;overflow:hidden">
            <div class="progress-bar" id="progress-${id}" style="height:100%;width:0%;background:linear-gradient(90deg,var(--blue),#6ea8ff)"></div>
          </div>
          <div style="width:56px;text-align:right;font-weight:700" id="percent-${id}">0%</div>
        </div>
      `;
      list.prepend(item);
      let pct = 0;
      const t = setInterval(()=>{
        pct += 10 + Math.round(Math.random()*10);
        if(pct>=100) pct=100;
        const bar = document.getElementById('progress-'+id);
        const lbl = document.getElementById('percent-'+id);
        const st = document.getElementById('status-'+id);
        bar && (bar.style.width = pct + '%');
        lbl && (lbl.textContent = pct + '%');
        st && (st.textContent = pct < 100 ? 'Uploading' : 'Complete');
        if(pct>=100){
          clearInterval(t);
          const openBtn = list.querySelector(`.action-btn.open-file[data-id="${id}"]`);
          if(openBtn) openBtn.onclick = ()=> window.location.href = 'view_invoice.html?inv=' + encodeURIComponent(id);
        }
      }, 250);
    });
    quickUploadInput.value = '';
  });

  // Wire example Open buttons
  document.querySelectorAll('.action-btn.open-file').forEach(btn=>{
    const id = btn.dataset.id;
    btn.addEventListener('click', e=>{ e.preventDefault(); window.location.href = 'view_invoice.html?inv=' + encodeURIComponent(id); });
  });

  // Single-upload modal handlers (choose file, simulate progress, show Done + View)
  const singleFileInput = document.getElementById('singleFileInput');
  const singleFileLabel = document.getElementById('singleFileLabel');
  const singleStartUploadBtn = document.getElementById('singleStartUploadBtn');
  const singleProgressWrap = document.getElementById('singleProgressWrap');
  const singleProgressBar = document.getElementById('singleProgressBar');
  const singleProgressText = document.getElementById('singleProgressText');
  const singleDoneWrap = document.getElementById('singleDoneWrap');
  const singleViewLink = document.getElementById('singleViewLink');
  const singleClear = document.getElementById('singleClear');
  const singleCancelBtn = document.getElementById('singleCancel');
  const singleDoneClose = document.getElementById('singleDoneClose');

  singleFileLabel && singleFileLabel.addEventListener('click', ()=> singleFileInput.click());
  singleFileInput && singleFileInput.addEventListener('change', ()=>{
    const f = singleFileInput.files && singleFileInput.files[0];
    if(f){
      singleFileLabel.textContent = f.name;
      singleStartUploadBtn.disabled = false;
      singleProgressWrap.style.display = 'none';
      singleDoneWrap.style.display = 'none';
      singleProgressBar.style.width = '0%';
      singleProgressText.textContent = 'Uploading 0%';
    } else {
      singleFileLabel.textContent = 'Click to choose file';
      singleStartUploadBtn.disabled = true;
    }
  });

  singleClear && singleClear.addEventListener('click', ()=>{
    singleFileInput.value = '';
    singleFileLabel.textContent = 'Click to choose file';
    singleStartUploadBtn.disabled = true;
    singleProgressWrap.style.display = 'none';
    singleDoneWrap.style.display = 'none';
  });

  let singleUploadSimTimer = null;
  function stopSingleUploadSim(){ if(singleUploadSimTimer){ clearInterval(singleUploadSimTimer); singleUploadSimTimer = null; } }
  singleCancelBtn && singleCancelBtn.addEventListener('click', ()=> {
    stopSingleUploadSim();
    singleProgressWrap.style.display = 'none';
    singleProgressBar.style.width = '0%';
    singleProgressText.textContent = 'Uploading 0%';
    singleStartUploadBtn.disabled = false;
    singleClear.disabled = false;
  });

  function finishSingleUpload(fileId){
    singleProgressWrap.style.display = 'none';
    singleDoneWrap.style.display = 'flex';
    singleViewLink.href = 'view_invoice.html?inv=' + encodeURIComponent(fileId || ('INV-DEMO-' + Date.now()));
    singleStartUploadBtn.disabled = true;
    singleClear.disabled = false;
    // add to right-panel
    const list = document.getElementById('uploadList');
    if(list){
      const item = document.createElement('div');
      item.className = 'upload-item';
      item.dataset.id = fileId;
      item.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="display:flex;gap:10px;align-items:center">
            <div style="width:36px;height:36;border-radius:8px;background:#eef6ff;display:flex;align-items:center;justify-content:center;color:var(--navy);font-weight:700">PDF</div>
            <div><div style="font-weight:700;color:var(--navy)">${fileId}.pdf</div><div class="small-muted" style="margin-top:4px">uploaded</div></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center"><div class="small-muted" id="status-${fileId}">Complete</div><button class="action-btn open-file" data-id="${fileId}">Open</button></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="flex:1;background:#f1f5f9;border-radius:8px;height:10px;overflow:hidden">
            <div class="progress-bar" id="progress-${fileId}" style="height:100%;width:100%;background:linear-gradient(90deg,var(--blue),#6ea8ff)"></div>
          </div>
          <div style="width:56px;text-align:right;font-weight:700">100%</div>
        </div>
      `;
      list.prepend(item);
      item.querySelector('.open-file').onclick = ()=> { window.location.href = 'view_invoice.html?inv=' + encodeURIComponent(fileId); };
    }
  }

  singleStartUploadBtn && singleStartUploadBtn.addEventListener('click', async ()=>{
    const file = singleFileInput.files && singleFileInput.files[0];
    if(!file){ alert('Please choose a file to upload.'); return; }
    singleProgressWrap.style.display = 'block';
    singleProgressBar.style.width = '0%';
    singleProgressText.textContent = 'Uploading 0%';
    singleStartUploadBtn.disabled = true;
    singleClear.disabled = true;
    let pct = 0;
    singleUploadSimTimer = setInterval(()=>{
      pct += 7 + Math.round(Math.random()*10);
      if(pct>=100) pct=100;
      singleProgressBar.style.width = pct + '%';
      singleProgressText.textContent = 'Uploading ' + pct + '%';
      if(pct>=100){
        stopSingleUploadSim();
        setTimeout(()=> finishSingleUpload('INV-DEMO-' + Date.now()), 400);
      }
    }, 250);
  });

  singleDoneClose && singleDoneClose.addEventListener('click', ()=> { closeUploadPanel(); singleFileInput.value = ''; singleFileLabel.textContent = 'Click to choose file'; singleStartUploadBtn.disabled = true; singleDoneWrap.style.display = 'none'; });

  // Wire example Open buttons already in DOM
  document.querySelectorAll('.action-btn.open-file').forEach(btn=>{
    const id = btn.dataset.id;
    btn.addEventListener('click', e=>{ e.preventDefault(); window.location.href = 'view_invoice.html?inv=' + encodeURIComponent(id); });
  });

  // Clear list handler
  document.getElementById('clearUploadList')?.addEventListener('click', ()=>{
    const list = document.getElementById('uploadList');
    if(list) list.innerHTML = '<div class="small-muted" style="padding:12px">No recent uploads</div>';
  });

  // Wire Upload dropdown toggles and other page scripts (unchanged behavior)
  (function(){
    const uploadBtn = document.getElementById('uploadBtn'), uploadMenu = document.getElementById('uploadMenu');
    const notifBtn = document.getElementById('notifBtn'), notifMenu = document.getElementById('notifMenu');
    const userBtn = document.getElementById('userBtn'), userMenu = document.getElementById('userMenu');

    function closeAllLocal(){
      if(uploadMenu) uploadMenu.style.display='none';
      if(notifMenu) notifMenu.style.display='none';
      if(userMenu) userMenu.style.display='none';
      if(uploadBtn) uploadBtn.setAttribute('aria-expanded','false');
      if(notifBtn) notifBtn.setAttribute('aria-expanded','false');
      if(userBtn) userBtn.setAttribute('aria-expanded','false');
    }

    if(uploadBtn) uploadBtn.addEventListener('click', (e)=>{ e.stopPropagation(); const open = uploadMenu.style.display==='block'; closeAllLocal(); uploadMenu.style.display = open ? 'none' : 'block'; uploadBtn.setAttribute('aria-expanded', String(!open)); });
    if(notifBtn) notifBtn.addEventListener('click', (e)=>{ e.stopPropagation(); const open = notifMenu.style.display==='block'; closeAllLocal(); notifMenu.style.display = open ? 'none' : 'block'; notifBtn.setAttribute('aria-expanded', String(!open)); });
    if(userBtn) userBtn.addEventListener('click', (e)=>{ e.stopPropagation(); const open = userMenu.style.display==='block'; closeAllLocal(); userMenu.style.display = open ? 'none' : 'block'; userBtn.setAttribute('aria-expanded', String(!open)); });

    document.getElementById('acctPrefs').addEventListener('click', (e)=> { e.preventDefault(); closeAllLocal(); alert('Navigate to Account Preferences (demo).'); });
    document.getElementById('signOutBtn').addEventListener('click', ()=>{ closeAllLocal(); alert('Signed out (demo).'); });

    // notifications and other handlers already wired above
    window.addEventListener('click', ()=> closeAllLocal());
    window.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeAllLocal(); });
  })();
</script>
</body>
</html>
